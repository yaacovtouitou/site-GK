{% extends 'base.html.twig' %}

{% block title %}Mon Coin GÃ©oula{% endblock %}

{% block body %}
<div class="space-y-6 sm:space-y-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {# User Profile Section #}
    <div class="grid lg:grid-cols-2 gap-6 sm:gap-8">
        {# Left: User Info #}
        <div class="glass-card rounded-[30px] p-6 sm:p-8">
            <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6">
                {# Avatar #}
                <div class="relative flex-shrink-0">
                    <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full bg-gradient-to-br from-royal-blue to-gold flex items-center justify-center text-4xl sm:text-5xl font-bold text-white shadow-xl overflow-hidden">
                        {% if user.avatar and user.avatar != 'avatar' %}
                            <img src="{{ user.avatar }}" alt="Avatar" class="w-full h-full object-cover">
                        {% else %}
                            {{ user.pseudo|first|upper }}
                        {% endif %}
                    </div>
                    <div class="absolute -bottom-2 -right-2 puffy-button-gold rounded-full p-2">
                        <span class="text-xl">â­</span>
                    </div>
                </div>

                {# User Details #}
                <div class="flex-1 text-center sm:text-left w-full">
                    <div class="flex flex-col sm:flex-row justify-between items-center sm:items-start mb-2 gap-2">
                        <h2 class="text-2xl sm:text-3xl font-bold text-royal-blue mb-1 break-all">
                            {{ user.pseudo }}
                        </h2>
                        <a href="{{ path('app_logout') }}" class="text-xs bg-red-100 text-red-600 hover:bg-red-200 px-3 py-1 rounded-full font-bold transition-colors whitespace-nowrap">
                            DÃ©connexion ğŸšª
                        </a>
                    </div>

                    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-[15px] bg-gradient-to-r from-vibrant-orange to-gold text-white font-bold text-sm mb-4">
                        <span>ğŸ†</span>
                        {{ user.currentRank|default('Soldat de la GÃ©oula') }}
                    </div>

                    {# Stats #}
                    <div class="grid grid-cols-3 gap-2 sm:gap-4 mt-4">
                        {% for stat in stats %}
                            <div class="text-center p-2 bg-white/50 rounded-xl">
                                <div class="text-lg sm:text-2xl font-bold {{ stat.color }}">
                                    {{ stat.value }}
                                </div>
                                <div class="text-[10px] sm:text-xs text-gray-600 leading-tight">
                                    {{ stat.label }}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            {# Energy Progress #}
            <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium">GÃ©oula Energy</span>
                    <span class="text-sm font-bold text-vibrant-orange">{{ user.energy }}%</span>
                </div>
                <div class="laser-progress-track h-4 w-full">
                    <div class="laser-progress-fill h-full transition-all duration-500 ease-out" style="width: {{ user.energy }}%"></div>
                </div>
            </div>
        </div>

        {# Right: Quick Stats #}
        <div class="glass-card rounded-[30px] p-6 sm:p-8">
            <h3 class="text-xl font-bold text-royal-blue mb-6 flex items-center gap-2">
                <span class="text-vibrant-orange">ğŸ…</span>
                Statistiques Rapides
            </h3>

            <div class="space-y-4">
                <div class="neo-card rounded-[20px] p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-700">Badges DÃ©bloquÃ©s</span>
                        <span class="font-bold text-royal-blue">{{ unlockedCount }}/{{ totalBadges }}</span>
                    </div>
                    <div class="laser-progress-track h-2 w-full">
                        <div class="laser-progress-fill h-full" style="width: {{ totalBadges > 0 ? (unlockedCount / totalBadges) * 100 : 0 }}%"></div>
                    </div>
                </div>

                <div class="neo-card rounded-[20px] p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-700">Prochain Grade : {{ rankInfo.nextRank ?? 'Max' }}</span>
                        <span class="font-bold text-gold">{{ rankInfo.progress|round }}%</span>
                    </div>
                    <div class="laser-progress-track h-2 w-full">
                        <div class="laser-progress-fill h-full" style="width: {{ rankInfo.progress }}%"></div>
                    </div>
                    {% if rankInfo.nextRank %}
                        <p class="text-xs text-gray-500 mt-1">Encore {{ rankInfo.pointsNeeded }} points pour devenir {{ rankInfo.nextRank }}</p>
                    {% else %}
                        <p class="text-xs text-gray-500 mt-1">Tu as atteint le sommet !</p>
                    {% endif %}
                </div>

                <div class="neo-card rounded-[20px] p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-700">Missions cette semaine</span>
                        <span class="font-bold text-vibrant-orange">{{ weeklyCompletions }}/{{ weeklyTarget }}</span>
                    </div>
                    <div class="laser-progress-track h-2 w-full">
                        <div class="laser-progress-fill h-full" style="width: {{ (weeklyCompletions / weeklyTarget * 100)|round }}%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Badge Gallery #}
    <section>
        <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-2">
            <h2 class="text-xl sm:text-2xl font-bold text-royal-blue flex items-center gap-2">
                <span class="text-vibrant-orange">ğŸ†</span>
                Ma Galerie de Badges
            </h2>
            <div class="text-sm text-gray-600">
                {{ unlockedCount }} / {{ totalBadges }} dÃ©bloquÃ©s
            </div>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-6">
            {% for badge in badges %}
                <div class="flex flex-col items-center gap-3 p-3 sm:p-4 neo-card rounded-[20px] transition-all duration-300 hover:scale-105">
                    <div class="relative w-16 h-16 sm:w-24 sm:h-24 rounded-full flex items-center justify-center {{ badge.unlocked ? 'holographic-badge shadow-xl' : 'locked-badge neo-inset' }} overflow-hidden">
                        {% if badge.image %}
                            <img src="{{ asset(badge.image) }}" alt="{{ badge.name }}" class="w-full h-full object-cover {{ badge.unlocked ? '' : 'opacity-50 grayscale' }}">
                        {% else %}
                            <span class="text-2xl sm:text-4xl">
                                {% if badge.icon == 'trophy' %}ğŸ†{% elseif badge.icon == 'star' %}â­{% elseif badge.icon == 'zap' %}âš¡{% elseif badge.icon == 'award' %}ğŸ…{% elseif badge.icon == 'crown' %}ğŸ‘‘{% elseif badge.icon == 'heart' %}â¤ï¸{% elseif badge.icon == 'book' %}ğŸ“–{% elseif badge.icon == 'target' %}ğŸ¯{% endif %}
                            </span>
                        {% endif %}
                    </div>
                    <div class="text-center w-full">
                        <h4 class="font-bold text-xs sm:text-sm md:text-base {{ badge.unlocked ? 'text-royal-blue' : 'text-gray-400' }} truncate w-full">
                            {{ badge.name }}
                        </h4>
                        <p class="text-[10px] sm:text-xs text-gray-500 mt-1 line-clamp-2 hidden sm:block">
                            {{ badge.description }}
                        </p>
                    </div>
                    {% if not badge.unlocked %}
                        <div class="text-[10px] sm:text-xs text-gray-400 font-medium">ğŸ”’ VerrouillÃ©</div>
                    {% endif %}
                </div>
            {% else %}
                <div class="col-span-full text-center text-gray-500 py-8">
                    <p>Aucun badge disponible pour le moment.</p>
                </div>
            {% endfor %}
        </div>
    </section>

    {# Motivational Section #}
    <div class="glass-card rounded-[30px] p-6 sm:p-8 text-center">
        <h3 class="text-lg sm:text-xl font-bold gradient-text mb-3">
            Continue comme Ã§a, Champion! ğŸ‰
        </h3>
        <p class="text-xs sm:text-sm md:text-base text-gray-700 max-w-2xl mx-auto">
            Tu es Ã  seulement 3 badges de devenir un Hassid Futuriste! ComplÃ¨te tes missions quotidiennes pour continuer Ã  progresser.
        </p>
    </div>
</div>
{% endblock %}
